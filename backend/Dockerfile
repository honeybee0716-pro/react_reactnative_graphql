FROM node:16.16.0

WORKDIR /backend

COPY ./ /backend

ARG DATABASE_URL=
ENV DATABASE_URL=${DATABASE_URL}

ARG NODE_ENV=
ENV NODE_ENV=${NODE_ENV}

ARG JWT_SECRET=
ENV JWT_SECRET=${JWT_SECRET}

ARG PORT=
ENV PORT=${PORT}

ARG SENDGRID_API_KEY=
ENV SENDGRID_API_KEY=${SENDGRID_API_KEY}

ARG STRIPE_SECRET_KEY=
ENV STRIPE_SECRET_KEY=${STRIPE_SECRET_KEY}

ARG DOMAIN=
ENV DOMAIN=${DOMAIN}

ARG PROTOCOL=
ENV PROTOCOL=${PROTOCOL}

ARG EMAIL_FROM=
ENV EMAIL_FROM=${EMAIL_FROM}

ARG SENTRY_DSN=
ENV SENTRY_DSN=${SENTRY_DSN}

ARG TWILIO_ACCOUNT_SID=
ENV TWILIO_ACCOUNT_SID=${TWILIO_ACCOUNT_SID}

ARG TWILIO_AUTH_TOKEN=
ENV TWILIO_AUTH_TOKEN=${TWILIO_AUTH_TOKEN}

ARG TWILIO_PHONE_NUMBER=
ENV TWILIO_PHONE_NUMBER=${TWILIO_PHONE_NUMBER}

ARG SLACK_WEBHOOK_URL=
ENV SLACK_WEBHOOK_URL=${SLACK_WEBHOOK_URL}

ARG REDISCLOUD_URL=
ENV REDISCLOUD_URL=${REDISCLOUD_URL}

ARG STRIPE_STANDARD_FLAT_PRICE_ID=
ENV STRIPE_STANDARD_FLAT_PRICE_ID=${STRIPE_STANDARD_FLAT_PRICE_ID}

ARG STRIPE_STANDARD_METERED_PRICE_ID=
ENV STRIPE_STANDARD_METERED_PRICE_ID=${STRIPE_STANDARD_METERED_PRICE_ID}

ARG STRIPE_SUCCESS_URL=
ENV STRIPE_SUCCESS_URL=${STRIPE_SUCCESS_URL}

ARG STRIPE_CANCEL_URL=
ENV STRIPE_CANCEL_URL=${STRIPE_CANCEL_URL}

ARG STRIPE_MANAGE_BILLING_CANCEL_URL=
ENV STRIPE_MANAGE_BILLING_CANCEL_URL=${STRIPE_MANAGE_BILLING_CANCEL_URL}

ARG STRIPE_PAYMENT_METHOD_TYPES=
ENV STRIPE_PAYMENT_METHOD_TYPES=${STRIPE_PAYMENT_METHOD_TYPES}

ARG SMTP_HOST=
ENV SMTP_HOST=${SMTP_HOST}

ARG SMTP_SECURE=
ENV SMTP_SECURE=${SMTP_SECURE}

ARG SMTP_PORT=
ENV SMTP_PORT=${SMTP_PORT}

ARG SMTP_USER=
ENV SMTP_USER=${SMTP_USER}

ARG SMTP_PASSWORD=
ENV SMTP_PASSWORD=${SMTP_PASSWORD}

ARG RUDDERSTACK_ID=
ENV RUDDERSTACK_ID=${RUDDERSTACK_ID}

ARG RUDDERSTACK_DATAPLANE=
ENV RUDDERSTACK_DATAPLANE=${RUDDERSTACK_DATAPLANE}

RUN yarn add global typescript

RUN yarn tsc

CMD ["node", "./dist/src/index.js"]

EXPOSE 8000