FROM node:16.16.0

WORKDIR /backend

COPY ./ /backend

ARG DATABASE_URL=mongodb+srv://clienteye-db1:6d8Cjuyiyf7xlu8s@cluster0.hl4lb.mongodb.net/clienteye-staging
ENV DATABASE_URL=${DATABASE_URL}

ARG NODE_ENV=localhost
ENV NODE_ENV=${NODE_ENV}

ARG JWT_SECRET=mysecret
ENV JWT_SECRET=${JWT_SECRET}

ARG PORT=8000
ENV PORT=${PORT}

ARG SENDGRID_API_KEY=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
ENV SENDGRID_API_KEY=${SENDGRID_API_KEY}

ARG STRIPE_SECRET_KEY=sk_test_51KvuyhGK5hA8adsFDucf8hqdWIIK6AM2kvk3efWYEHMy1ud8A2R4PFlwd0wL5NAYkVPTBzhEM4rR8nJfPg9RmPAT00BTvi4gQu
ENV STRIPE_SECRET_KEY=${STRIPE_SECRET_KEY}

ARG DOMAIN=localhost
ENV DOMAIN=${DOMAIN}

ARG PROTOCOL=https
ENV PROTOCOL=${PROTOCOL}

ARG EMAIL_FROM=joey@outsmarted.io
ENV EMAIL_FROM=${EMAIL_FROM}

ARG SENTRY_DSN=https://32fd5e1f231c4644a77cc448efaeeb24@o189240.ingest.sentry.io/6383690
ENV SENTRY_DSN=${SENTRY_DSN}

ARG TWILIO_ACCOUNT_SID=ACffd3c4e2e82c19cc568065cb5ca4fefe
ENV TWILIO_ACCOUNT_SID=${TWILIO_ACCOUNT_SID}

ARG TWILIO_AUTH_TOKEN=5e02f5d99bdbdc36d9b6bae67948047b
ENV TWILIO_AUTH_TOKEN=${TWILIO_AUTH_TOKEN}

ARG TWILIO_PHONE_NUMBER=+19793562674
ENV TWILIO_PHONE_NUMBER=${TWILIO_PHONE_NUMBER}

ARG SLACK_WEBHOOK_URL=https://hooks.slack.com/services/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
ENV SLACK_WEBHOOK_URL=${SLACK_WEBHOOK_URL}

ARG REDISCLOUD_URL=redis://localhost:6379
ENV REDISCLOUD_URL=${REDISCLOUD_URL}

ARG STRIPE_STANDARD_FLAT_PRICE_ID=price_1LGvxAGK5hA8adsFZND3zg0e
ENV STRIPE_STANDARD_FLAT_PRICE_ID=${STRIPE_STANDARD_FLAT_PRICE_ID}

ARG STRIPE_STANDARD_METERED_PRICE_ID=price_1LGvxAGK5hA8adsFUcJ6no7C
ENV STRIPE_STANDARD_METERED_PRICE_ID=${STRIPE_STANDARD_METERED_PRICE_ID}

ARG STRIPE_TEMP_CUSTOM_PLAN_ID=price_1LMfIiGK5hA8adsFzvktBwn2
ENV STRIPE_TEMP_CUSTOM_PLAN_ID=${STRIPE_TEMP_CUSTOM_PLAN_ID}

ARG STRIPE_SUCCESS_URL=http://localhost:3000/stripe-success
ENV STRIPE_SUCCESS_URL=${STRIPE_SUCCESS_URL}

ARG STRIPE_CANCEL_URL=http://localhost:3000/pricing
ENV STRIPE_CANCEL_URL=${STRIPE_CANCEL_URL}

ARG STRIPE_MANAGE_BILLING_CANCEL_URL=http://localhost:3000/billing
ENV STRIPE_MANAGE_BILLING_CANCEL_URL=${STRIPE_MANAGE_BILLING_CANCEL_URL}

ARG STRIPE_PAYMENT_METHOD_TYPES="['card', 'us_bank_account']"
ENV STRIPE_PAYMENT_METHOD_TYPES=${STRIPE_PAYMENT_METHOD_TYPES}

ARG SMTP_HOST=smtp.sendgrid.net
ENV SMTP_HOST=${SMTP_HOST}

ARG SMTP_SECURE=false
ENV SMTP_SECURE=${SMTP_SECURE}

ARG SMTP_PORT=587
ENV SMTP_PORT=${SMTP_PORT}

ARG SMTP_USER=alerts@saastemplate.io
ENV SMTP_USER=${SMTP_USER}

ARG SMTP_PASSWORD=~q5<2kr21@i4
ENV SMTP_PASSWORD=${SMTP_PASSWORD}

ARG RUDDERSTACK_ID=2CKPLYFWWwh9BsIOCksorBkdMLu
ENV RUDDERSTACK_ID=${RUDDERSTACK_ID}

ARG RUDDERSTACK_DATAPLANE=https://outsmartedadwa.dataplane.rudderstack.com
ENV RUDDERSTACK_DATAPLANE=${RUDDERSTACK_DATAPLANE}

RUN yarn add global typescript

RUN yarn tsc

CMD ["node", "./dist/src/index.js"]

EXPOSE 8000